# ë§ˆì´ í˜ì´ì§€ & ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„ ì™„ë£Œ ğŸ‰

## ğŸ“‹ ì™„ë£Œëœ ì‘ì—…

### 1. ë§ˆì´ í˜ì´ì§€ êµ¬í˜„ âœ…

**íŒŒì¼**: `src/pages/mypage/page.tsx`

#### ì£¼ìš” ê¸°ëŠ¥

##### ğŸ”¹ í”„ë¡œí•„ íƒ­
- ì´ë©”ì¼ (ë³€ê²½ ë¶ˆê°€)
- ì‚¬ìš©ìëª… (ë³€ê²½ ë¶ˆê°€)
- í‘œì‹œ ì´ë¦„ (ìˆ˜ì • ê°€ëŠ¥)
- ì„±ë³„ (ìˆ˜ì • ê°€ëŠ¥)
- ìƒë…„ì›”ì¼ (ìˆ˜ì • ê°€ëŠ¥)
- ìê¸°ì†Œê°œ (ìˆ˜ì • ê°€ëŠ¥)
- ì‹¤ì‹œê°„ ìˆ˜ì •/ì €ì¥ ê¸°ëŠ¥

##### ğŸ”¹ í†µê³„ & ì½”ì¸ íƒ­
- ë³´ìœ  ì½”ì¸ ìˆ˜
- ì´ í™œë™ í¬ì¸íŠ¸
- ì±„êµ´ ì†ë„
- í”Œë«í¼ í™œë™ ë‚´ì—­
  - ìº£ë£¸ ë°©ë¬¸ íšŸìˆ˜
  - í¼ë‹ˆë²„ìŠ¤ êµ¬ë§¤ ê°œìˆ˜
  - ë®¤í‹€ëŸ¬ ì±„íŒ… íšŸìˆ˜
  - í›„ì› í™œë™ íšŸìˆ˜

##### ğŸ”¹ ë‚´ ê³ ì–‘ì´ íƒ­
- ë“±ë¡ëœ ê³ ì–‘ì´ ëª©ë¡
- ê³ ì–‘ì´ë³„ ì •ë³´ ì¹´ë“œ
  - ì´ë¦„, í’ˆì¢…
  - ìƒë…„ì›”ì¼
  - ì„±ë³„
  - ëŒ€í‘œ ê³ ì–‘ì´ í‘œì‹œ
- ê³ ì–‘ì´ ì¶”ê°€ ë²„íŠ¼

##### ğŸ”¹ ì„¤ì • íƒ­
- **ì•Œë¦¼ ì„¤ì •**
  - ì´ë©”ì¼ ì•Œë¦¼ on/off
  - í‘¸ì‹œ ì•Œë¦¼ on/off
  - ë§ˆì¼€íŒ… ì´ë©”ì¼ on/off
  - ì‹¤ì‹œê°„ ì €ì¥

- **ì†Œì…œ ê³„ì • ì—°ê²°**
  - Google (ì—°ê²°ë¨)
  - Apple (ì¤€ë¹„ ì¤‘)
  - GitHub (ì¤€ë¹„ ì¤‘)
  - Facebook (ì¤€ë¹„ ì¤‘)

- **ë³´ì•ˆ**
  - ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
  - 2ë‹¨ê³„ ì¸ì¦ (ì¤€ë¹„ ì¤‘)

- **ìœ„í—˜ êµ¬ì—­**
  - ê³„ì • ì‚­ì œ

### 2. ë¼ìš°íŒ… ì„¤ì • âœ…

**íŒŒì¼**: `src/router/config.tsx`

```tsx
const MyPage = lazy(() => import('../pages/mypage/page'));

{
  path: '/mypage',
  element: <MyPage />
},
```

### 3. Header í†µí•© âœ…

**íŒŒì¼**: `src/components/feature/Header.tsx`

**ë³€ê²½ ì‚¬í•­**:
- ë¡œê·¸ì¸ ì‹œ ì‚¬ìš©ìëª… í´ë¦­ â†’ `/mypage` ì´ë™
- ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ ì œê±° (ë§ˆì´í˜ì´ì§€ ë‚´ì—ì„œ ì²˜ë¦¬)
- ëª¨ë°”ì¼ ë©”ë‰´ì—ë„ ë™ì¼ ì ìš©

**ì „:**
```tsx
<div>ì‚¬ìš©ìëª…</div>
<button>ë¡œê·¸ì•„ì›ƒ</button>
```

**í›„:**
```tsx
<button onClick={() => navigate('/mypage')}>
  {user?.username}
</button>
```

## ğŸ” Supabase ì†Œì…œ ë¡œê·¸ì¸ ê°€ì´ë“œ

### ì§€ì›ë˜ëŠ” ì†Œì…œ ë¡œê·¸ì¸ ì œê³µì

#### âœ… í•„ìˆ˜ (ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥)
1. **Google** - ì´ë¯¸ êµ¬í˜„ë¨ âœ…
2. **Apple** - Supabase ì§€ì›
3. **GitHub** - Supabase ì§€ì›
4. **Facebook** - Supabase ì§€ì›

#### âœ… ì„ íƒ (Supabase ê³µì‹ ì§€ì›)
5. **Discord** - ì»¤ë®¤ë‹ˆí‹°ìš©
6. **Twitter (X)** - SNS
7. **Microsoft (Azure)** - ê¸°ì—…ìš©
8. **LinkedIn** - ë¹„ì¦ˆë‹ˆìŠ¤ìš©

#### âš ï¸ í•œêµ­ ì„œë¹„ìŠ¤ (ì»¤ìŠ¤í…€ êµ¬í˜„ í•„ìš”)
9. **ì¹´ì¹´ì˜¤í†¡** - Edge Functions í•„ìš”
10. **ë„¤ì´ë²„** - Edge Functions í•„ìš”

### ì†Œì…œ ë¡œê·¸ì¸ êµ¬í˜„ ìˆœì„œ

#### Phase 1: Supabase Dashboard ì„¤ì •

1. **Supabase Dashboard ì ‘ì†**
   ```
   https://supabase.com/dashboard
   â†’ í”„ë¡œì íŠ¸ ì„ íƒ
   â†’ Authentication
   â†’ Providers
   ```

2. **ì œê³µìë³„ Enable ë° ì„¤ì •**

   **Apple ì˜ˆì‹œ:**
   ```
   1. Apple Developerì—ì„œ Service ID ìƒì„±
   2. Callback URL: https://your-project.supabase.co/auth/v1/callback
   3. Supabaseì— Service IDì™€ Key ì…ë ¥
   ```

   **GitHub ì˜ˆì‹œ:**
   ```
   1. GitHub Settings > Developer settings > OAuth Apps
   2. New OAuth App
   3. Callback URL: https://your-project.supabase.co/auth/v1/callback
   4. Client IDì™€ Secretì„ Supabaseì— ì…ë ¥
   ```

#### Phase 2: ì½”ë“œ êµ¬í˜„

**AuthContextì— ì†Œì…œ ë¡œê·¸ì¸ í•¨ìˆ˜ ì¶”ê°€**:

```tsx
// src/context/AuthContext.tsx

const loginWithApple = async () => {
  const { data, error } = await supabase.auth.signInWithOAuth({
    provider: 'apple',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`
    }
  });

  if (error) throw error;
  return data;
};

const loginWithGitHub = async () => {
  const { data, error } = await supabase.auth.signInWithOAuth({
    provider: 'github',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`
    }
  });

  if (error) throw error;
  return data;
};

const loginWithFacebook = async () => {
  const { data, error } = await supabase.auth.signInWithOAuth({
    provider: 'facebook',
    options: {
      redirectTo: `${window.location.origin}/auth/callback`,
      scopes: 'email public_profile'
    }
  });

  if (error) throw error;
  return data;
};
```

**ë¡œê·¸ì¸ í˜ì´ì§€ì— ë²„íŠ¼ ì¶”ê°€**:

```tsx
// src/pages/login/page.tsx

<button onClick={loginWithApple}>
  <i className="ri-apple-fill"></i>
  Appleë¡œ ë¡œê·¸ì¸
</button>

<button onClick={loginWithGitHub}>
  <i className="ri-github-fill"></i>
  GitHubë¡œ ë¡œê·¸ì¸
</button>

<button onClick={loginWithFacebook}>
  <i className="ri-facebook-fill"></i>
  Facebookìœ¼ë¡œ ë¡œê·¸ì¸
</button>
```

#### Phase 3: í•œêµ­ ì„œë¹„ìŠ¤ (ì¹´ì¹´ì˜¤, ë„¤ì´ë²„)

**Supabase Edge Function ì‚¬ìš©**:

```typescript
// supabase/functions/kakao-auth/index.ts

import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

serve(async (req) => {
  const { code } = await req.json();

  // ì¹´ì¹´ì˜¤ í† í° ìš”ì²­
  const tokenResponse = await fetch('https://kauth.kakao.com/oauth/token', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: new URLSearchParams({
      grant_type: 'authorization_code',
      client_id: Deno.env.get('KAKAO_CLIENT_ID')!,
      redirect_uri: Deno.env.get('KAKAO_REDIRECT_URI')!,
      code,
    }),
  });

  const tokens = await tokenResponse.json();

  // ì¹´ì¹´ì˜¤ ì‚¬ìš©ì ì •ë³´ ìš”ì²­
  const userResponse = await fetch('https://kapi.kakao.com/v2/user/me', {
    headers: { Authorization: `Bearer ${tokens.access_token}` },
  });

  const kakaoUser = await userResponse.json();

  // Supabase Authì— ì‚¬ìš©ì ìƒì„±/ë¡œê·¸ì¸
  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  const { data, error } = await supabase.auth.admin.createUser({
    email: kakaoUser.kakao_account.email,
    email_confirm: true,
    user_metadata: {
      provider: 'kakao',
      kakao_id: kakaoUser.id,
      nickname: kakaoUser.properties.nickname,
    },
  });

  return new Response(JSON.stringify({ data, error }), {
    headers: { 'Content-Type': 'application/json' },
  });
});
```

## ğŸ”’ 2ë‹¨ê³„ ì¸ì¦ (2FA) êµ¬í˜„

### Supabase MFA ì§€ì›

#### TOTP (Time-based OTP)

**1. 2FA ë“±ë¡**:

```tsx
const enable2FA = async () => {
  const { data, error } = await supabase.auth.mfa.enroll({
    factorType: 'totp',
    friendlyName: 'My Phone',
  });

  if (error) throw error;

  // QR ì½”ë“œ í‘œì‹œ
  const qrCode = data.totp.qr_code;
  const secret = data.totp.secret;

  return { qrCode, secret, factorId: data.id };
};
```

**2. ì¸ì¦ ì½”ë“œ ê²€ì¦**:

```tsx
const verify2FACode = async (factorId: string, code: string) => {
  // Challenge ìƒì„±
  const { data: challengeData } = await supabase.auth.mfa.challenge({
    factorId,
  });

  // ì½”ë“œ ê²€ì¦
  const { data, error } = await supabase.auth.mfa.verify({
    factorId,
    challengeId: challengeData.id,
    code,
  });

  if (error) throw error;
  return data;
};
```

**3. UI ì»´í¬ë„ŒíŠ¸**:

```tsx
// 2FA ì„¤ì • í˜ì´ì§€
export function TwoFactorSetup() {
  const [qrCode, setQrCode] = useState('');
  const [code, setCode] = useState('');

  const handleEnable = async () => {
    const { qrCode, factorId } = await enable2FA();
    setQrCode(qrCode);
    // QR ì½”ë“œë¥¼ í‘œì‹œí•˜ì—¬ ì‚¬ìš©ìê°€ ìŠ¤ìº”
  };

  const handleVerify = async () => {
    await verify2FACode(factorId, code);
    showFeedback('2ë‹¨ê³„ ì¸ì¦ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤!');
  };

  return (
    <div>
      <img src={qrCode} alt="QR Code" />
      <input
        value={code}
        onChange={(e) => setCode(e.target.value)}
        placeholder="6ìë¦¬ ì½”ë“œ"
      />
      <button onClick={handleVerify}>ì¸ì¦</button>
    </div>
  );
}
```

## ğŸ“Š ë§ˆì´í˜ì´ì§€ ë°ì´í„° ì—°ë™

### ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

```tsx
useEffect(() => {
  const loadData = async () => {
    // í”„ë¡œí•„
    const { data: profile } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', user.id)
      .single();

    // ì½”ì¸ & ì„¤ì •
    const { data: settings } = await supabase
      .from('user_settings')
      .select('coins, total_activity, mining_rate')
      .eq('user_id', user.id)
      .single();

    // ê³ ì–‘ì´
    const { data: cats } = await supabase
      .from('cats')
      .select('*')
      .eq('owner_id', user.id)
      .order('is_primary', { ascending: false });

    // ì„ í˜¸ë„
    const { data: preferences } = await supabase
      .from('user_preferences')
      .select('*')
      .eq('user_id', user.id)
      .single();

    setState({ profile, settings, cats, preferences });
  };

  loadData();
}, [user]);
```

## ğŸ¨ ë§ˆì´í˜ì´ì§€ UI íŠ¹ì§•

### ë ˆì´ì•„ì›ƒ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ì´ë“œë°”â”‚  ë©”ì¸ ì½˜í…ì¸                â”‚
â”‚         â”‚                            â”‚
â”‚ í”„ë¡œí•„  â”‚  [ì„ íƒëœ íƒ­ì˜ ë‚´ìš©]        â”‚
â”‚ ìš”ì•½    â”‚                            â”‚
â”‚         â”‚                            â”‚
â”‚ [í”„ë¡œí•„]â”‚                            â”‚
â”‚ [í†µê³„]  â”‚                            â”‚
â”‚ [ê³ ì–‘ì´]â”‚                            â”‚
â”‚ [ì„¤ì •]  â”‚                            â”‚
â”‚         â”‚                            â”‚
â”‚ ë¡œê·¸ì•„ì›ƒâ”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë””ìì¸ ì‹œìŠ¤í…œ
- **ë°°ê²½**: Space ê·¸ë¼ë°ì´ì…˜
- **ê¸€ë˜ìŠ¤ëª¨í”¼ì¦˜**: íˆ¬ëª… íš¨ê³¼
- **ë„¤ì˜¨ ì»¬ëŸ¬**: ë³´ë¼/ë¶„í™ ê·¸ë¼ë°ì´ì…˜
- **ë°˜ì‘í˜•**: ëª¨ë°”ì¼/íƒœë¸”ë¦¿/ë°ìŠ¤í¬í†±

### í†µê³„ ì¹´ë“œ ìƒ‰ìƒ
| í•­ëª© | ìƒ‰ìƒ | ì•„ì´ì½˜ |
|------|------|--------|
| ì½”ì¸ | ë…¸ë‘ | ri-coin-line |
| í™œë™ | íŒŒë‘ | ri-pulse-line |
| ì†ë„ | ì´ˆë¡ | ri-speed-line |

## ğŸš€ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë§ˆì´í˜ì´ì§€
- [x] í”„ë¡œí•„ íƒ­ êµ¬í˜„
- [x] í†µê³„ & ì½”ì¸ íƒ­ êµ¬í˜„
- [x] ë‚´ ê³ ì–‘ì´ íƒ­ êµ¬í˜„
- [x] ì„¤ì • íƒ­ êµ¬í˜„
- [x] ë¼ìš°íŒ… ì¶”ê°€
- [x] Header ë§í¬ ì¶”ê°€
- [ ] ì‹¤ì œ ë°ì´í„° ì—°ë™ (í–¥í›„)
- [ ] í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ (í–¥í›„)

### ì†Œì…œ ë¡œê·¸ì¸
- [x] Google (ì™„ë£Œ)
- [ ] Apple (Supabase ì„¤ì • í•„ìš”)
- [ ] GitHub (Supabase ì„¤ì • í•„ìš”)
- [ ] Facebook (Supabase ì„¤ì • í•„ìš”)
- [ ] ì¹´ì¹´ì˜¤í†¡ (Edge Function í•„ìš”)
- [ ] ë„¤ì´ë²„ (Edge Function í•„ìš”)

### 2ë‹¨ê³„ ì¸ì¦
- [ ] TOTP êµ¬í˜„
- [ ] QR ì½”ë“œ ìƒì„±
- [ ] ì¸ì¦ ì½”ë“œ ê²€ì¦
- [ ] ë³µêµ¬ ì½”ë“œ ìƒì„±

## ğŸ“ ì¶”ê°€ êµ¬í˜„ í•„ìš” ì‚¬í•­

### 1. í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ
```tsx
const uploadAvatar = async (file: File) => {
  const { data, error } = await supabase.storage
    .from('avatars')
    .upload(`${user.id}/${file.name}`, file);

  if (error) throw error;

  const url = supabase.storage
    .from('avatars')
    .getPublicUrl(data.path).data.publicUrl;

  await supabase
    .from('profiles')
    .update({ avatar_url: url })
    .eq('id', user.id);
};
```

### 2. ê³„ì • ì‚­ì œ
```tsx
const deleteAccount = async () => {
  // í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
  const confirmed = window.confirm(
    'ì •ë§ë¡œ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'
  );

  if (!confirmed) return;

  // ëª¨ë“  ë°ì´í„° ì‚­ì œ (RLS ì •ì±…ì— ë”°ë¼ ìë™ ì‚­ì œ)
  await supabase.auth.admin.deleteUser(user.id);

  // ë¡œê·¸ì•„ì›ƒ
  await logout();
  navigate('/');
};
```

### 3. ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
```tsx
const changePassword = async (newPassword: string) => {
  const { error } = await supabase.auth.updateUser({
    password: newPassword,
  });

  if (error) throw error;
  showFeedback('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤');
};
```

## ğŸ”— ìœ ìš©í•œ ë§í¬

- [Supabase Auth ë¬¸ì„œ](https://supabase.com/docs/guides/auth)
- [ì†Œì…œ ë¡œê·¸ì¸ ê°€ì´ë“œ](https://supabase.com/docs/guides/auth/social-login)
- [MFA ë¬¸ì„œ](https://supabase.com/docs/guides/auth/auth-mfa)
- [Edge Functions](https://supabase.com/docs/guides/functions)

---

**ì™„ë£Œì¼**: 2025-01-13
**ë‹´ë‹¹**: Claude AI Assistant
**ìƒíƒœ**: âœ… ê¸°ë³¸ êµ¬í˜„ ì™„ë£Œ, ì¶”ê°€ ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘
