# 뮤니언 온보딩 시스템 설정 가이드

## 📋 개요

회원가입 후 사용자가 다음 정보를 단계별로 입력할 수 있는 온보딩 시스템이 구현되었습니다:

1. **닉네임 설정** - 미니홈피 주소 생성
2. **프로필 정보** - 이름, 성별, 생년월일, 자기소개
3. **고양이 정보** - 이름, 품종, 성별, 생년월일 등 (선택사항)
4. **서비스 선호도** - 알림 설정, 테마 선택

## 🗄️ 데이터베이스 마이그레이션

### 1. Supabase SQL Editor에서 실행

1. **Supabase 대시보드 접속**
   - https://supabase.com/dashboard
   - 프로젝트 선택

2. **SQL Editor로 이동**
   - 왼쪽 메뉴에서 "SQL Editor" 클릭

3. **마이그레이션 SQL 실행**
   - `supabase-onboarding-schema.sql` 파일의 내용을 복사
   - SQL Editor에 붙여넣기
   - "Run" 버튼 클릭

### 2. 추가된 테이블 및 필드

#### profiles 테이블 확장
```sql
- display_name: text (표시될 이름)
- bio: text (자기소개)
- gender: text (성별)
- birth_date: date (생년월일)
- phone: text (전화번호)
- onboarding_completed: boolean (온보딩 완료 여부)
```

#### cats 테이블 (신규)
```sql
- id: uuid (고유 ID)
- owner_id: uuid (소유자 ID)
- name: text (고양이 이름)
- breed: text (품종)
- gender: text (성별)
- birth_date: date (생년월일)
- adoption_date: date (입양일)
- weight: numeric (체중)
- photo_url: text (사진 URL)
- bio: text (소개)
- microchip_id: text (마이크로칩 ID)
- is_primary: boolean (대표 고양이 여부)
```

#### user_preferences 테이블 (신규)
```sql
- user_id: uuid (사용자 ID)
- email_notifications: boolean (이메일 알림)
- push_notifications: boolean (푸시 알림)
- marketing_emails: boolean (마케팅 이메일)
- interests: jsonb (관심사 배열)
- theme: text (테마: retro/modern/dark)
- language: text (언어: ko/en)
```

## 🚀 온보딩 플로우

### 회원가입 → 온보딩 프로세스

#### 1️⃣ 일반 회원가입 (이메일/비밀번호)
```
회원가입 폼 작성 → 이메일 인증 → 닉네임 설정 → 온보딩 페이지
```

#### 2️⃣ Google OAuth 회원가입
```
Google 로그인 → 프로필 자동 생성 → 온보딩 페이지
```

### 온보딩 단계별 화면

#### Step 1: 닉네임 설정 (필수)
- 영어, 숫자, 언더스코어만 사용
- 3자 이상
- 중복 확인 필수
- 미니홈피 주소: `mewnion.io/{username}`

#### Step 2: 프로필 정보 (필수)
- 이름 (필수)
- 성별 (선택)
- 생년월일 (선택)
- 자기소개 (선택)

#### Step 3: 고양이 정보 (선택)
- 이름
- 품종
- 성별
- 생년월일
- 소개
- **건너뛰기 가능**

#### Step 4: 서비스 선호도 (필수)
- 알림 설정
  - 이메일 알림
  - 푸시 알림
  - 마케팅 이메일 (선택)
- 테마 선택
  - 레트로 🕹️
  - 모던 ✨
  - 다크 🌙

#### Step 5: 완료
- 온보딩 완료 표시 (onboarding_completed = true)
- 홈으로 리다이렉트

## 📁 구현된 파일

### 1. 페이지 컴포넌트
- `src/pages/onboarding/page.tsx` - 다단계 온보딩 페이지

### 2. 라우터 설정
- `src/router/config.tsx` - `/onboarding` 경로 추가

### 3. 플로우 연결
- `src/pages/auth/callback/page.tsx` - OAuth 콜백 → 온보딩 연결
- `src/pages/signup/page.tsx` - 회원가입 → 온보딩 연결

### 4. 데이터베이스 스키마
- `supabase-onboarding-schema.sql` - 온보딩 관련 테이블 및 필드

## 🎨 UI 특징

### 레트로 사이버펑크 스타일
- CRT 효과
- 네온 그린 (#00ff00) 테두리
- 터미널 폰트
- 깜빡이는 텍스트
- 프로그레스 바 (0% → 25% → 50% → 75% → 100%)

### 반응형 디자인
- 모바일/데스크톱 최적화
- 터치 친화적 버튼 크기

## 🔒 보안 및 권한

### Row Level Security (RLS)
- profiles: 본인만 수정 가능, 모두 조회 가능
- cats: 본인만 CRUD, 모두 조회 가능
- user_preferences: 본인만 CRUD

### 자동 기능
- 첫 번째 고양이 자동으로 primary 설정
- primary 고양이 변경 시 기존 primary 해제
- updated_at 자동 업데이트

## 🧪 테스트 시나리오

### 1. 일반 회원가입
1. `/signup` 접속
2. 이메일/비밀번호 입력
3. 닉네임 설정
4. 온보딩 페이지 진행
5. 모든 단계 완료 후 홈으로 이동

### 2. Google 회원가입
1. "Google로 회원가입" 클릭
2. Google 계정 선택
3. 온보딩 페이지로 자동 리다이렉트
4. 모든 단계 완료 후 홈으로 이동

### 3. 온보딩 중단 후 재접속
1. 온보딩 중간에 페이지 이탈
2. 다시 로그인
3. 자동으로 온보딩 페이지로 리다이렉트
4. 이전 단계부터 계속 진행

### 4. 고양이 정보 건너뛰기
1. Step 3에서 "건너뛰기" 클릭
2. 바로 Step 4로 이동
3. 나중에 프로필에서 고양이 추가 가능

## 📊 데이터 흐름

```
회원가입
  ↓
auth.users 생성 (Supabase Auth)
  ↓
profiles 자동 생성 (trigger)
  ↓
온보딩 페이지
  ↓
Step 1: username 업데이트
  ↓
Step 2: display_name, bio, gender, birth_date 업데이트
  ↓
Step 3: cats 테이블에 레코드 생성 (선택)
  ↓
Step 4: user_preferences 테이블에 레코드 생성
  ↓
onboarding_completed = true
  ↓
홈 화면
```

## 🔧 추가 개선 사항 (향후)

1. **고양이 사진 업로드**
   - Supabase Storage 연동
   - 이미지 리사이징
   - 썸네일 생성

2. **관심사 선택 UI**
   - 미리 정의된 카테고리
   - 다중 선택 가능
   - 태그 형식

3. **온보딩 진행률 저장**
   - 어느 단계까지 완료했는지 저장
   - 중단 후 이어하기

4. **프로필 수정 기능**
   - 온보딩 완료 후에도 정보 수정 가능
   - 고양이 추가/수정/삭제

5. **여러 고양이 등록**
   - Step 3에서 여러 마리 추가
   - 대표 고양이 선택

## ⚠️ 주의사항

1. **데이터베이스 마이그레이션 필수**
   - 서비스 배포 전 반드시 `supabase-onboarding-schema.sql` 실행

2. **기존 사용자 처리**
   - 이미 가입한 사용자는 onboarding_completed가 null일 수 있음
   - 로그인 시 온보딩 페이지로 리다이렉트될 수 있음
   - 필요 시 기존 사용자 onboarding_completed를 true로 일괄 업데이트

3. **username 필수**
   - 온보딩을 완료하려면 반드시 username이 필요
   - username 없이는 서비스 이용 불가

4. **Google OAuth 이메일 인증**
   - Google 계정이 이메일 인증이 되어있으므로 별도 인증 불필요

## 🚀 배포 체크리스트

- [ ] Supabase SQL 마이그레이션 실행
- [ ] 테스트 환경에서 전체 플로우 테스트
- [ ] 기존 사용자 데이터 마이그레이션 계획
- [ ] 에러 핸들링 검증
- [ ] 모바일 반응형 테스트
- [ ] 다국어 지원 (향후)

---

**구현 완료일**: 2025-01-13
**담당**: Claude AI Assistant
**문의**: 개발팀
