name: Render Keep Alive

# Render ë¬´ë£Œ í”Œëœì€ 15ë¶„ ë¹„í™œì„±ì‹œ ìŠ¬ë¦½ ëª¨ë“œ ì§„ì…
# 10ë¶„ë§ˆë‹¤ í•‘ì„ ë³´ë‚´ í•­ìƒ í™œì„± ìƒíƒœ ìœ ì§€
on:
  schedule:
    # ë§¤ 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (Render 15ë¶„ ìŠ¬ë¦½ ë°©ì§€)
    - cron: '*/10 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  ping-render:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Render Service
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸŒ Render.com Keep-Alive Ping"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ğŸ“… Time: $(date '+%Y-%m-%d %H:%M:%S %Z')"
          echo ""

          # Renderì— ë°°í¬ëœ ì‚¬ì´íŠ¸ URL (ë°°í¬ í›„ ì—…ë°ì´íŠ¸ í•„ìš”)
          RENDER_URL="${{ secrets.RENDER_URL }}"

          if [ -z "$RENDER_URL" ]; then
            echo "â­ï¸ RENDER_URL not set in secrets"
            echo "â„¹ï¸ Add your Render URL to GitHub Secrets when deployed"
            echo ""
            echo "ì˜ˆì‹œ:"
            echo "  Repository Settings â†’ Secrets â†’ New secret"
            echo "  Name: RENDER_URL"
            echo "  Value: https://your-app.onrender.com"
          else
            echo "ğŸ”„ Pinging: $RENDER_URL"

            RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
              "$RENDER_URL" \
              --max-time 60 \
              -H "User-Agent: GitHub-Actions-KeepAlive/1.0") || RESPONSE="FAILED"

            echo "   Response: HTTP $RESPONSE"

            if [ "$RESPONSE" = "200" ] || [ "$RESPONSE" = "301" ] || [ "$RESPONSE" = "302" ]; then
              echo "   âœ… Service is awake and responding"
            elif [ "$RESPONSE" = "000" ]; then
              echo "   â³ Service might be spinning up (cold start)"
            else
              echo "   âš ï¸ Unexpected response: $RESPONSE"
            fi
          fi

          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Render ping completed"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: Ping Health Endpoint (if available)
        run: |
          RENDER_URL="${{ secrets.RENDER_URL }}"

          if [ -n "$RENDER_URL" ]; then
            echo "ğŸ¥ Checking health endpoint..."

            # /health ë˜ëŠ” /api/health ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
            for endpoint in "/health" "/api/health" ""; do
              URL="${RENDER_URL}${endpoint}"
              HEALTH=$(curl -s -o /dev/null -w "%{http_code}" \
                "$URL" \
                --max-time 30) || HEALTH="FAILED"

              if [ "$HEALTH" = "200" ]; then
                echo "   âœ… Health check passed: $URL"
                break
              fi
            done
          fi
